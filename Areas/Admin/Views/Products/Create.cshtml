@model BaiTap_03_23WebC_Nhom10.Models.Product
@{
    Layout = "_Layout";
}

@section title {
        Thêm sản phẩm
}

<div class="card-body">
    <form id="frmAddProduct" enctype="multipart/form-data">
        <div class="row g-3">
            <div class="col-12">
                <label class="form-label fw-bold">Tên sản phẩm</label>
                <input type="text" id="PRODUCT_NAME" class="form-control" required>

                <label class="form-label fw-bold mt-3">Giá</label>
                <input type="number" id="PRICE" class="form-control" required>

                <label class="form-label fw-bold mt-3">Số lượng</label>
                <input type="number" id="QUALITY" class="form-control">

                <label class="form-label fw-bold mt-3">Giảm giá (%)</label>
                <input type="number" id="DISCOUNT" class="form-control">

                <label class="form-label fw-bold mt-3">Mô tả</label>
                <textarea id="DESCRIPTION" rows="4" class="form-control"></textarea>

                <label class="form-label fw-bold mt-3">Danh mục</label>
                <div class="d-flex align-items-center">
                    <select id="CATEGORY_ID" class="form-select me-3" style="width: 250px;">
                        <option value="">-- Chọn danh mục --</option>
                        <option value="1">Điện thoại</option>
                        <option value="2">Laptop</option>
                    </select>
                    <button type="button" class="btn btn-success flex-shrink-0"
                            data-bs-toggle="modal" data-bs-target="#modalAddCategory">
                        More Than
                    </button>
                </div>

                

                <label class="form-label fw-bold mt-3">Tag</label>
                <input type="number" id="TAG_ID" class="form-control">
                <br />
                <label class="form-label fw-bold mt-3">Hình ảnh sản phẩm</label>
                <input type="file" id="IMAGE" class="form-control" multiple accept="image/*" onchange="previewImages(event)">
                <br />
                <div id="previewContainer" class="d-flex flex-wrap mt-2 gap-2"></div>
            </div>
        </div>
        <br />
        <div class="text-center mt-4">
            <button type="button" id="btnAdd" class="btn btn-outline-primary">
                <i class="bi bi-save"></i> Lưu sản phẩm
            </button>
        </div>
    </form>
</div>


<!-- Modal Thêm Danh Mục -->
<div class="modal" id="modalAddCategory" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white text-center">
                <h5 class="modal-title w-100 fs-4 fw-bold" id="modalAddCategoryLabel">
                    <i class="bi bi-plus-circle"></i> Thêm danh mục mới
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <label class="form-label fw-bold">Tên danh mục</label>
                <input type="text" id="newCategoryName" class="form-control" placeholder="Nhập tên danh mục...">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" id="btnSaveCategory">Lưu</button>
            </div>
        </div>
    </div>
</div>

@section js {
    <script>
        // Xem trước hình ảnh
        function previewImages(event) {
            const container = document.getElementById("previewContainer");
            container.innerHTML = "";
            for (let file of event.target.files) {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.className = "rounded border";
                    img.style.width = "200px";
                    img.style.height = "200px";
                    img.style.objectFit = "cover";
                    container.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        // Thêm danh mục bằng Ajax
        document.getElementById("btnSaveCategory").addEventListener("click", () => {
            const name = document.getElementById("newCategoryName").value.trim();
            if (!name) return alert("Vui lòng nhập tên danh mục!");

            $.ajax({
                url: '/Admin/Categories/AddCategory', // API mẫu
                type: 'POST',
                data: { name },
                success: function (newCat) {
                    $('#CATEGORY_ID').append(`<option value="${newCat.id}">${newCat.name}</option>`);
                    $('#CATEGORY_ID').val(newCat.id);
                    $('#modalAddCategory').modal('hide');
                    $('#newCategoryName').val('');
                },
                error: function () {
                    alert("Lỗi khi thêm danh mục!");
                }
            });
        });
    </script>
}

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Form Thêm Sản Phẩm</h5>
        </div>
        <div class="card-body">
            <form asp-area="Admin" asp-controller="Products" asp-action="Create" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label asp-for="TenSp" class="form-label">Tên Sản Phẩm</label>
                    <input asp-for="TenSp" class="form-control" placeholder="Nhập tên sản phẩm (ví dụ: iPhone 15 Pro Max)" />
                    <span asp-validation-for="TenSp" class="text-danger"></span>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label asp-for="DonGia" class="form-label">Đơn Giá (VNĐ)</label>
                        <input asp-for="DonGia" class="form-control" type="number" step="1000" min="0" placeholder="0" />
                        <span asp-validation-for="DonGia" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label asp-for="DonGiaKhuyenMai" class="form-label">Khuyến Mãi (Tỉ lệ, ví dụ: 0.1)</label>
                        <input asp-for="DonGiaKhuyenMai" class="form-control" type="number" step="0.01" min="0" max="1" placeholder="0.1" />
                        <span asp-validation-for="DonGiaKhuyenMai" class="text-danger"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label asp-for="MaDm" class="form-label">Danh Mục Sản Phẩm</label>
                        <select asp-for="MaDm"
                                class="form-select"
                                asp-items="@(ViewBag.DanhMuc as SelectList)">
                            <option value="">-- Chọn Danh Mục --</option>
                        </select>
                        <span asp-validation-for="MaDm" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Upload Hình Ảnh</label>
                        <input type="file" name="HinhAnhFile" class="form-control" />
                    </div>
                </div>

                <div class="mb-3">
                    <label asp-for="MoTa" class="form-label">Mô Tả</label>
                    <textarea asp-for="MoTa" class="form-control" rows="4" placeholder="Nhập mô tả chi tiết sản phẩm..."></textarea>
                    <span asp-validation-for="MoTa" class="text-danger"></span>
                </div>

                <div class="d-flex justify-content-between">
                    <a asp-action="Index" class="btn btn-secondary">
                        Quay lại
                    </a>
                    <button type="submit" class="btn btn-primary">
                        Thêm Sản Phẩm
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

